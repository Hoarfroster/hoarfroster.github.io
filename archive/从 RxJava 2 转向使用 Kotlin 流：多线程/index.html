<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä» RxJava 2 è½¬å‘ä½¿ç”¨ Kotlin æµï¼šå¤šçº¿ç¨‹</title>
    <script src="/assets/script/main.js"></script>
    <link rel="stylesheet" href="/assets/style/styles.css">
</head>

<body>
    <div class="header">
    <div class="container">
        <div class="icon">
            <img src="/assets/media/vectors/hoarfroster-text.svg" alt="Hoarfroster Logo with Text">
        </div>
        <nav class="navigation">
            <ul class="header-navigation-list">
                <li><a href="/">é¦–é¡µ</a></li>
                <li><a href="/archive.html">æ–‡ç« </a></li>
                <li><a href="/about.html">å…³äº</a></li>
            </ul>
            <form action="/search" method="post">
                <label>
                    <input type="text" class="search" placeholder="æœç´¢å’•å’•å’•çš„å°ç«™"/>
                </label>
                <label class="submit">
                    <input type="submit"/>
                </label>
            </form>
        </nav>
        <ul class="social-accounts">
            <li>
                <a href="https://www.zhihu.com/people/shuang-yu-29-75">
                    <i class="fa-brands fa-zhihu" style="font-size: 20px; color:#06f; line-height: 20px;"></i>
                </a>
            </li>
            <li>
                <a href="https://github.com/PassionPenguin">
                    <img src="/assets/media/vectors/github.svg" alt="github-logo"/>
                </a>
            </li>
            <li>
                <a href="https://dribbble.com/Hoarfroster">
                    <img src="/assets/media/vectors/dribbble.svg" alt="dribbble-logo"/>
                </a>
            </li>
        </ul>
    </div>
</div>
    <div class="content article">
        <article>
            <div class="title">
                <h1>ä» RxJava 2 è½¬å‘ä½¿ç”¨ Kotlin æµï¼šå¤šçº¿ç¨‹</h1>
                <p><span class='chars'>undefined chars</span><span class='created-date'>Created Sat May 28 2022 23:43:08 GM</span><span class='modified-date'>Modified Sat May 28 2022 23:43:08 GM</span></p>
            </div>
            <div class="main markdown-body">
                

<blockquote>
<ul>
<li>åŸæ–‡åœ°å€ï¼š<a href="https://proandroiddev.com/from-rxjava-2-to-kotlin-flow-threading-8618867e1955">From
RxJava 2 to Kotlin Flow: Threading</a></li>
<li>åŸæ–‡ä½œè€…ï¼š<a href="https://medium.com/@krossovochkin">Vasya
Drobushkov</a></li>
<li>è¯‘è€…ï¼š<a href="https://github.com/PassionPenguin">éœœç¾½
Hoarfroster</a></li>
<li>æ ¡å¯¹è€…ï¼š<a href="https://github.com/samyu2000">samyu2000</a>ã€<a href="https://github.com/zenblo">zenblo</a></li>
</ul>
</blockquote>
<p><img src="https://cdn-images-1.medium.com/max/2000/0*piI5NnrRuivMUOKD" alt="æ¥æº"></p>
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p>é•¿æœŸä»¥æ¥ï¼ŒRxJava ä¸€ç›´æ˜¯ Android
å“åº”å¼è§£å†³æ–¹æ¡ˆçš„æ— å¯äº‰è®®çš„å¼•é¢†è€…ã€‚è™½ç„¶ Kotlin
ä¸æ–­æ‰©å±•ï¼Œå¹¶ä¸”å¼•å…¥äº†å†·æµï¼ˆFlowï¼‰çš„æ¦‚å¿µï¼Œæƒ…å†µå¯èƒ½åœ¨æœªæ¥å‡ å¹´è¿…é€Ÿæ”¹å˜ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€
RxJava
ä¼šé€€å‡ºå†å²èˆå°ã€‚è™½è¯´å“åº”å¼ç¼–ç¨‹æœ€åˆä¸çº¿ç¨‹æ— å…³ï¼Œä½†åˆé€‚çš„çº¿ç¨‹çš„å¹¶å‘å’Œå¹¶è¡Œå¯¹ç¨‹åºè€Œè¨€ä»ç„¶éå¸¸é‡è¦ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ç®€è¦å›é¡¾
RxJava 2 ä¸­çš„çº¿ç¨‹ï¼ˆå¯¹å…¶ç”¨æ³•åšä¸€äº›åŸºæœ¬è¯´æ˜ï¼‰ï¼Œç„¶åè®¨è®ºä¸€ä¸‹ Kotlin Flow
ä¸­çº¿ç¨‹çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬èƒ½åœ¨ä¸å½±å“åŠŸèƒ½çš„æƒ…å†µä¸‹èƒ½å¤Ÿé¡ºåˆ©åœ°å®Œæˆä»£ç è¿ç§»ã€‚</p>
<p>è®©æˆ‘ä»¬ä»å¯¹ RxJava 2 çš„ç®€çŸ­å›é¡¾å¼€å§‹ã€‚</p>
<h2 id="rxjava-2">RxJava 2</h2>
<p>RxJava 2 çš„ <code>Observable</code> å’Œ Kotlin çš„ Flow
éƒ½æ˜¯å†·æµï¼Œæ„å‘³ç€å…¶ä¸­çš„ä»£ç åœ¨è®¢é˜…ä¹‹å‰éƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<blockquote>
<p>é™¤äº† <code>Observable</code> ä»¥å¤–ï¼Œåœ¨ RxJava ä¸­å…¶å®è¿˜æœ‰å…¶å®ƒç±»å‹ï¼Œä¾‹å¦‚
<code>Flowable</code> æˆ–æ˜¯ <code>Single</code>
ç­‰ã€‚ä½†åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åªä¼šè®²è®²
<code>Observable</code>ï¼Œå› ä¸ºå®ƒä»¬çš„åŸç†æ˜¯ç›¸ä¼¼çš„ã€‚</p>
</blockquote>
<p>RxJava <code>Observable</code> çš„æœ€åŸºç¡€ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>observeSomething<span class="op">()</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬è®¢é˜…äº†è¾“å…¥è¾“å‡ºäº‹ä»¶ã€‚ç¨‹åºè¿è¡Œæ—¶ï¼Œåªè¦å‘ç”Ÿäº† I/O
äº‹ä»¶ï¼Œå°±ä¼šæŠŠæ¥æ”¶åˆ°çš„ç»“æœåœ¨ä¸»çº¿ç¨‹æ‰“å°å‡ºæ¥ã€‚</p>
<h4 id="subscribeon">subscribeOn</h4>
<p>subscribeOn æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œç”¨äºå£°æ˜å°†åœ¨å“ªä¸€ä¸ªè°ƒåº¦å™¨ä¸Šè®¾ç½®ä¸€ä¸ª
<code>Observable</code>
çš„è®¢é˜…ã€‚â€œå°†åœ¨å“ªä¸€ä¸ªè°ƒåº¦å™¨ä¸Šè®¢é˜…â€æ˜¯æŒ‡â€œå°†åœ¨å“ªä¸ªè°ƒåº¦å™¨ä¸Šå¯åŠ¨æˆ‘ä»¬çš„æ‰§è¡Œç¨‹åºâ€ã€‚</p>
<p>ç¬¬ä¸€ä¸ªåˆ’é‡ç‚¹çš„åœ°æ–¹æ˜¯ï¼šæˆ‘ä»¬å¹¶ä¸éœ€è¦ç®¡ <code>subscribeOn</code>
å…·ä½“åœ¨å“ªä¸ªåœ°æ–¹å£°æ˜ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>observeSomething<span class="op">()</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<p>ä¹Ÿå¯ä»¥è¿™æ ·ï¼š</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>observeSomething<span class="op">()</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<p>ä¸Šè¿°ä¸¤ç§æƒ…å†µçš„è¿è¡Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè¿™å¹¶ä¸æ„å¤–ã€‚æˆ‘ä»¬é€šè¿‡åœ¨è¿™ä¸€ä¸²ä»£ç é“¾ä¸­å£°æ˜äº†è¿™äº›è¿ç®—ç¬¦å£°æ˜äº†è¿™ä¸ªé“¾çš„å¼€å§‹ï¼Œä½†å…¶ä¸­çš„æŸäº›è¿ç®—ç¬¦æœ¬èº«å¹¶ä¸ä¾èµ–äºå£°æ˜çš„ä½ç½®ï¼Œå°±ä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­é‚£æ ·ã€‚</p>
<p>ç¬¬äºŒä¸ªåˆ’é‡ç‚¹çš„åœ°æ–¹æ˜¯ï¼Œå› ä¸ºä¸€ä¸ªé“¾å¹¶ä¸èƒ½åŒæ—¶åœ¨å¤šä¸ªè°ƒåº¦å™¨å¤„å¯åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬æ— éœ€åœ¨é“¾ä¸­æ·»åŠ å¤šä¸ª
<code>subscribeOn</code>ï¼Œå› ä¸ºåªæœ‰å…¶ä¸­ä¹‹ä¸€ä¼šèµ·ä½œç”¨ã€‚å¦‚æœå‡ºäºæŸç§åŸå› ä½ å°†å¤šä¸ª
<code>subscribeOn</code>
è¿ç®—ç¬¦æ”¾åœ¨é“¾ä¸­ï¼Œåˆ™æœ€ä¸Šé¢çš„ä¸€ä¸ªå°†è¢«ä½¿ç”¨ï¼Œè€Œæœ€ä¸‹é¢çš„å°†è¢«å¿½ç•¥ï¼š</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>observeSomething<span class="op">()</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span> <span class="co">// è¿™ä¸ªä¼šè¢«ä½¿ç”¨ä¸Š</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span> <span class="co">// è¿™ä¸ªä¼šç›´æ¥è¢«å¿½ç•¥</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<h4 id="observeon">observeOn</h4>
<p><code>subscribeOn</code> è¡¨ç¤ºå°†åœ¨å“ªä¸ªè°ƒåº¦å™¨ä¸Šå¯åŠ¨é“¾ï¼Œè€Œ
<code>observeOn</code> è¡¨ç¤ºå°†åœ¨å“ªä¸ªè°ƒåº¦å™¨ä¸Šè¿è¡Œçº¿ç¨‹ã€‚å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€
<code>observeOn</code> ä¼šæ›´æ”¹ä¸‹é¢çš„é“¾ä¸­çš„è¿è¡Œçš„çº¿ç¨‹çš„è°ƒåº¦å™¨ã€‚</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1 */</span> observeSomething<span class="op">()</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1 */</span>     <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2 */</span>     <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2 */</span>     <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°ä»é“¾å¼€å§‹ï¼Œç›´åˆ°é“¾ä¸Šçš„ <code>observeOn</code>
å®šä¹‰æ˜¯ç¬¬ä¸€éƒ¨åˆ†ï¼Œç„¶å <code>observeOn</code> æ›´æ”¹é“¾è¦åœ¨
<code>mainThread</code> è°ƒåº¦å™¨ä¸Šè¿è¡Œï¼Œå› æ­¤ç°åœ¨ä»¥ä¸‹å…¨éƒ¨å†…å®¹éƒ½åœ¨
<code>mainThread</code> ï¼ˆç¬¬äºŒéƒ¨åˆ†ï¼‰ä¸Šæ‰§è¡Œã€‚</p>
<p>ä¸ <code>subscribeOn</code>
ä¸åŒï¼Œå®é™…ä¸Šå¦‚æœçœŸçš„éœ€è¦ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ å¤šä¸ª <code>observeOn</code>ï¼š</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1 */</span> observeSomething<span class="op">()</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* 1 */</span>     <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2 */</span>     <span class="op">.</span>observeOn<span class="op">(</span>computation<span class="op">())</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* 2 */</span>     <span class="op">.</span>map <span class="op">{</span> result <span class="op">-&gt;</span> result<span class="op">.</span>length <span class="op">}</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">/* 3 */</span>     <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* 3 */</span>     <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<p>å¦‚ä¸Šé¢çš„ä¾‹å­é‚£æ ·ï¼Œæˆ‘ä»¬å…ˆä»ç½‘ç»œä¸Šè·å–ä¸€äº›æ•°æ®ï¼Œæ¥ç€è¿›è¡Œä¸€äº›è®¡ç®—å¤„ç†ï¼Œå†æ‰“å°ç»“æœã€‚ã€‚æˆ‘ä»¬æ·»åŠ äº†å¤šä¸ª
<code>observeOn</code>ï¼Œè®©ç¨‹åºé¦–å…ˆåˆ‡æ¢åˆ° <code>computation</code>
è°ƒåº¦å™¨ï¼ˆè¿™æ ·åšçš„ç›®çš„æ˜¯åœ¨åå°çº¿ç¨‹ä¸­è¿›è¡Œè®¡ç®—ï¼Œè¿™æ˜¯ç¬¬äºŒéƒ¨åˆ†ï¼‰ï¼Œç„¶ååˆ‡æ¢åˆ°
<code>mainThread</code> æ‰“å°ç»“æœã€‚</p>
<h4 id="just--defer">just + defer</h4>
<p><code>subscribeOn</code> çš„ä¸€ä¸ªå¸¸è§é”™è¯¯æ˜¯å°†å®ƒä¸
<code>Observable.just</code> ä¸€èµ·ä½¿ç”¨ã€‚</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Observable<span class="op">.</span>just<span class="op">(</span>loadDataSync<span class="op">())</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<p><code>just</code>
å‚æ•°çš„å€¼æ˜¯ç«‹å³è®¡ç®—çš„ï¼Œè€Œä¸æ˜¯åœ¨è®¢é˜…æ—¶æ‰è®¡ç®—çš„ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨åœ¨ä¸»çº¿ç¨‹ä¸Šåˆ›å»ºæ­¤ç±»å¯è§‚å¯Ÿçš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šåœ¨ä¸»çº¿ç¨‹ä¸Šè¿›è¡Œå¤§é‡æ½œåœ¨çš„è®¡ç®—ã€‚è™½è¯´è®¢é˜…å°†åœ¨
<code>io</code> ä¸Šæ­£ç¡®å®Œæˆï¼Œä½†æ˜¯ <code>just</code>
çš„å€¼å°†åœ¨è®¢é˜…ä¹‹å‰å°±è¢«è®¡ç®—å‡ºæ¥äº†ã€‚</p>
<p>è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•ä¹‹ä¸€æ˜¯å°†ä½ çš„ <code>Observable.just</code> è°ƒç”¨åŒ…è£…åˆ°
<code>Observable.defer</code>
ä¸­ï¼Œè¿™æ ·è°ƒç”¨æ‰€æ‰§è¡Œçš„æ‰€æœ‰å†…å®¹éƒ½å°†åœ¨è®¢é˜…æ—¶ä»¥åŠåœ¨æˆ‘ä»¬ä½äº
<code>subscribeOn</code> å¤„æ‰€å£°æ˜çš„è°ƒåº¦å™¨ä¸Šè¿›è¡Œè®¡ç®—ï¼š</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Observable<span class="op">.</span>defer <span class="op">{</span> Observable<span class="op">.</span>just<span class="op">(</span>loadDataSync<span class="op">())</span> <span class="op">}</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<h4 id="flatmap-çš„å¹¶å‘å’Œå¹¶è¡Œ">flatMap çš„å¹¶å‘å’Œå¹¶è¡Œ</h4>
<p>å¦ä¸€ä¸ªæ£˜æ‰‹çš„äº‹æƒ…æ¥è‡ªä½¿ç”¨è¿ç®—ç¬¦ <code>flatMap</code>
å’Œæˆ‘ä»¬å¯¹å¹¶å‘æ€§å’Œå¹¶è¡Œæ€§çš„ç†è§£ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬æ‹¥æœ‰ ID åˆ—è¡¨æµï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸€ä¸ª ID
éƒ½æ‰§è¡Œä¸€æ¬¡ä»ç½‘ç»œä¸­åŠ è½½æ•°æ®ï¼š</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Observable<span class="op">.</span>fromIterable<span class="op">(</span>listOf<span class="op">(</span><span class="st">"id1"</span><span class="op">,</span> <span class="st">"id2"</span><span class="op">,</span> <span class="st">"id3"</span><span class="op">))</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>flatMap <span class="op">{</span> id <span class="op">-&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        loadData<span class="op">(</span>id<span class="op">)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>toList<span class="op">()</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<p>æˆ‘ä»¬åœ¨è¿™é‡Œçš„é¢„æœŸæ˜¯ï¼Œæˆ‘ä»¬å·²ç»è®¢é˜…äº† <code>io</code>ï¼Œ<code>io()</code>
çš„åº•å±‚æœ‰çº¿ç¨‹æ± ï¼Œå› æ­¤å¯¹æ¯ä¸ª <code>id</code> çš„ <code>loadData</code>
çš„è°ƒç”¨æ˜¯å¹¶è¡Œçš„ã€‚ä½†æ˜¯äº‹å®å¹¶éå¦‚æ­¤ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>flatMap</code>
ç¼–å†™äº†å¹¶å‘ä»£ç ï¼Œä½†å®ƒä¸æ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œå…¶åŸå› æ˜¯æˆ‘ä»¬å‘Šè¯‰äº†ç¨‹åºæˆ‘ä»¬è¦åœ¨
<code>io</code> ä¸Šå¯åŠ¨é“¾ã€‚æˆ‘ä»¬çš„é“¾çš„èµ·ç‚¹åœ¨ <code>flatMapIterable</code>
ä¸Šï¼Œè¿™æ„å‘³ç€åœ¨è®¢é˜…åï¼Œå°†ä½¿ç”¨ <code>io</code>
æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶åœ¨è¯¥å•ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œæ‰€æœ‰çº¿ç¨‹ã€‚ä¸ºäº†æ”¹å˜è¡Œä¸ºå¹¶ä½¿æˆ‘ä»¬çš„ä»£ç å¹¶è¡Œè¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦å°†
<code>subscribeOn</code> ç§»åŠ¨åˆ° <code>flatMap</code> ä¹‹å†…ï¼š</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Observable<span class="op">.</span>fromIterable<span class="op">(</span>listOf<span class="op">(</span><span class="st">"id1"</span><span class="op">,</span> <span class="st">"id2"</span><span class="op">,</span> <span class="st">"id3"</span><span class="op">))</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>flatMap <span class="op">{</span> id <span class="op">-&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        loadData<span class="op">(</span>id<span class="op">)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>toList<span class="op">()</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<p>ä¸€æ—¦æ‰§è¡Œåˆ°äº†
<code>flatMap</code>ï¼Œæ¯ä¸ªå†…éƒ¨çš„å¯è§‚å¯Ÿå¯¹è±¡ï¼ˆ<code>flatMap</code>
å†…éƒ¨çš„å¯è§‚å¯Ÿå¯¹è±¡ï¼‰éƒ½å°†è¢«è®¢é˜…ã€‚æ„å‘³ç€åœ¨æ¯ä¸€æ¬¡æ‰§è¡Œ <code>loadData</code>
å‡½æ•°ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªè®¢é˜…ï¼Œä» <code>io</code>
æ± ä¸­è·å–æ–°çº¿ç¨‹ã€‚è¿™æ ·æˆ‘ä»¬å°±è¾¾åˆ°äº†å¹¶è¡Œæ€§ã€‚</p>
<p>å› æ­¤ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¯¸å¦‚ <code>flatMap</code>
ä¹‹ç±»çš„è¿ç®—ç¬¦æ—¶ï¼Œæˆ‘ä»¬çš„é“¾åº”è¯¥æœ‰å¤šä¸ªè®¢é˜…ç‚¹ï¼šä¸€ä¸ªç”¨äºåŸå§‹é“¾èµ·ç‚¹ï¼Œæ¯ä¸ªç”¨äºå†…éƒ¨çš„å¯è§‚å¯Ÿç‚¹ï¼š</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* è®¢é˜…ç‚¹ 1 */</span> Observable<span class="op">.</span>fromIterable<span class="op">(</span>listOf<span class="op">(</span><span class="st">"id1"</span><span class="op">,</span> <span class="st">"id2"</span><span class="op">,</span> <span class="st">"id3"</span><span class="op">))</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>flatMap <span class="op">{</span> id <span class="op">-&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* è®¢é˜…ç‚¹ 2 */</span>             loadData<span class="op">(</span>id<span class="op">)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                            <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                            <span class="op">.</span>flatMap <span class="op">{</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* è®¢é˜…ç‚¹ 3 */</span>                     loadData2<span class="op">(</span>id<span class="op">)</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="op">.</span>subscribeOn<span class="op">(</span>io<span class="op">())</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                            <span class="op">}</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>observeOn<span class="op">(</span>mainThread<span class="op">())</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>toList<span class="op">()</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>subscribe <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<p>ä»£ç ä¸­çš„æ³¨é‡ŠæŒ‡å‘äº†æ¯ä¸€ä¸ªè®¢é˜…å‘ç”Ÿçš„ä½ç½®ã€‚é€šè¿‡ä½¿ç”¨
<code>subscribeOn</code>ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜åœ¨è¿™äº›æƒ…å†µä¸‹åº”è¯¥åœ¨å“ªä¸ªè°ƒåº¦ç¨‹åºè®¢é˜…ä¸Šè¿›è¡Œã€‚</p>
<h4 id="å•çº¿ç¨‹è¿è¡Œ">å•çº¿ç¨‹è¿è¡Œ</h4>
<p>æœ€åï¼Œä½†ä¹ŸåŒæ ·é‡è¦çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ <code>subscribeOn</code> æˆ–
<code>observeOn</code>ï¼Œé‚£ä¹ˆä»£ç å°†æ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œæ‰€æœ‰æ‰§è¡Œå°†æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€ä¸ªè¯­å¥çš„å¯è§‚å¯Ÿåˆ°çš„å®Œæ•´æ‰§è¡Œä¹‹å‰æ˜¯æš‚åœçš„ã€‚</p>
<p>ä»¥ä¸Šå°±åŸºæœ¬ä¸Šæ˜¯ RxJava ä¸­çš„çº¿ç¨‹çš„å…¨éƒ¨å†…å®¹ï¼Œè®©æˆ‘ä»¬ç°åœ¨èµ°è¿› Kotlin
æµã€‚</p>
<h2 id="kotlin-æµ">Kotlin æµ</h2>
<p>Kotlin æµçš„æœ€åŸºç¡€ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>CoroutineScope<span class="op">(</span>Job<span class="op">()</span> <span class="op">+</span> Dispatchers<span class="op">.</span>Main<span class="op">).</span>launch <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    observeSomething<span class="op">()</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>flowOn<span class="op">(</span>Dispatchers<span class="op">.</span>IO<span class="op">)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>collect <span class="op">{</span> result <span class="op">-&gt;</span> println<span class="op">(</span>result<span class="op">)</span> <span class="op">}</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<blockquote>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†è®¸å¤šä¸åç¨‹ç›¸å…³çš„æ¦‚å¿µï¼Œå¯èƒ½éœ€è¦å¯¹å…¶è¿›è¡Œè§£é‡Šã€‚æˆ‘ä»¬ä¸ä¼šæ·±å…¥ä»‹ç»åç¨‹è¿™ä¸ªåŠŸèƒ½æˆ–æ˜¯
Kotlin Flowï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨ä¸ç†Ÿæ‚‰åç¨‹ï¼Œæœ€å¥½å…ˆé˜…è¯»æœ‰å…³åç¨‹çš„æ–‡æ¡£ã€‚</p>
</blockquote>
<p>è¯¥ç¤ºä¾‹åœ¨æŸç§ç¨‹åº¦ä¸Šä¸ RxJava éƒ¨åˆ†ä¸­ä½¿ç”¨çš„ç¤ºä¾‹ç›¸åŒï¼šæˆ‘ä»¬è§‚å¯Ÿäº†
<code>io</code> çš„ä¸€äº›å˜åŒ–ï¼Œç„¶ååœ¨ <code>main</code>
ä¸Šæ‰“å°ç»“æœï¼Œå°½ç®¡ä»£ç æœ‰æ‰€ä¸åŒã€‚è®©æˆ‘ä»¬æ‰¾å‡ºåŒºåˆ«ä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<p>é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼Œåªèƒ½åœ¨æŸäº›åç¨‹èŒƒå›´å†…æ”¶é›†æµï¼ˆå› ä¸º <code>collect</code>
æ–¹æ³•éœ€è¦åœ¨ <code>suspend</code>
å‡½æ•°ä¸‹æ‰§è¡Œï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†åˆå¹¶èŒƒå›´ï¼Œå¹¶åœ¨è¯¥èŒƒå›´å†…â€œå¯åŠ¨â€äº†æ–°çš„åç¨‹ã€‚åœ¨å¯åŠ¨çš„åç¨‹ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ”¶é›†æµã€‚</p>
<p>å…³äº Kotlin
æµå’Œæ”¶é›†åŠŸèƒ½çš„é‡è¦ä¸€ä»¶äº‹æ˜¯ç§°ä¸ºä¸Šä¸‹æ–‡ä¿ç•™çš„åŠŸèƒ½ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æ— éœ€å£°æ˜è¦åœ¨å“ªä¸ªè°ƒåº¦å™¨ä¸Šæ”¶é›†æ•°æ®ï¼Œè¯¥è°ƒåº¦ç¨‹åºå§‹ç»ˆä¸æˆ‘ä»¬ä»æµä¸­æ”¶é›†æ•°æ®çš„èŒƒå›´ç›¸åŒã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœè¦åœ¨ Main ä¸­è¿›è¡Œæ”¶é›†ï¼Œåˆ™éœ€è¦åœ¨åç¨‹ä¸­ä½¿ç”¨
<code>Dispatchers.Main</code> æ¥è°ƒç”¨ <code>collect</code> å‡½æ•°ã€‚</p>
<h4 id="flowon">flowOn</h4>
<p>è¿™æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œç”¨äºæ›´æ”¹å·¥ä½œæµæ‰€å¤„çš„ä¸Šä¸‹æ–‡ï¼ˆå°¤å…¶æ˜¯çº¿ç¨‹è°ƒåº¦ï¼‰ã€‚</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*QOMRfQTktM17z2xHUYmcrQ.png"></p>
<p>å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ç¼–å†™
<code>flowOn(Dispatchers.IO)</code>ï¼Œæˆ‘ä»¬å‘Šè¯‰äº†ç¨‹åºæˆ‘ä»¬å¸Œæœ›åœ¨è¾“å…¥è¾“å‡ºä¸Šè¿è¡Œæ‰§è¡Œæ‰€æœ‰ä»£ç ã€‚</p>
<p>å¦‚æœåƒä»¥å‰çš„ RxJava ä¸€æ ·åœ¨ <code>map</code>
å†…éƒ¨æ·»åŠ ä¸€äº›è®¡ç®—ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*zpbvxCRXjGLSEuFlnrWarg.png"></p>
<p>æˆ‘ä»¬å°†çœ‹åˆ°ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¯ä»¥é€šè¿‡åœ¨è¿ç®—ç¬¦ä¹‹åå£°æ˜ <code>flowOn</code>
æ¥æ›´æ”¹è¿ç®—ç¬¦çš„å·¥ä½œä½ç½®ã€‚</p>
<h4 id="launchin">launchIn</h4>
<p>å…³äº <code>collect</code> å‡½æ•°çš„ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯å®ƒå¸¦æœ‰
<code>suspend</code> å£°æ˜çš„ã€‚è¿™æ„å‘³ç€å½“æˆ‘ä»¬è°ƒç”¨ <code>collect</code>
å‡½æ•°çš„æ—¶å€™ï¼Œæ‰§è¡Œä¼šè¢«æš‚åœç›´åˆ°æµçš„å®Œæˆã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªåç¨‹ä¸­æ”¾å…¥ä¸¤ä¸ª <code>collect</code>
å‡½æ•°ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå°†æœ‰æ•ˆåœ°é˜»æ­¢ç¬¬äºŒä¸ªæ‰§è¡Œï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*xopZFayVenZK03PQ9RoZ0Q.png"></p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°æ‰“å°äº†è¿”å›å€¼å‡ºæ¥ï¼Œä½†å¹¶æ²¡æœ‰æ˜¾ç¤ºç¬¬äºŒæ¬¡çš„è¿”å›å€¼ï¼Œå› ä¸ºç¬¬ä¸€ä¸ª
<code>collect</code> å‡½æ•°ä¼šè¢«æš‚åœå¹¶ä¸”ä¸å…è®¸è¿›è¡Œç¬¬äºŒæ¬¡
<code>collect</code> å‡½æ•°çš„æ‰§è¡Œã€‚</p>
<p>è¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦åœ¨ä¸åŒçš„åç¨‹ä¸­å¯åŠ¨å„è‡ªæµã€‚</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*511-boC1pDMN9gLmK9ySKg.png"></p>
<p>ä½†æ˜¯è¿™ä¸ªä»£ç çœ‹èµ·æ¥å¹¶ä¸æ¼‚äº®ï¼Œå¹¶ä¸”è¦ä½¿å…¶çœ‹èµ·æ¥æ›´å¥½ä¸€ç‚¹ï¼ˆæ²¡æœ‰é™„åŠ çš„åµŒå¥—çº§åˆ«ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†
<code>launchIn</code> æ‰©å±•åŠŸèƒ½ï¼ˆåªæ˜¯ä¸ªåœ¨åŒ…è£…çš„å¯åŠ¨ä¸­çš„è¯­æ³•ç³–ï¼‰ä¸
<code>onEach</code> ç»“åˆä½¿ç”¨ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*atQKeG0bwwMfjBD7nBIZHg.png"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬åˆ›å»ºçš„ä»£ç çœ‹èµ·æ¥æ›´åƒæˆ‘ä»¬ä¹‹å‰åœ¨ RxJavaä¸Šå†™è¿‡çš„é‚£æ ·ï¼Œå› ä¸º
RxJava ä¸­çš„è®¢é˜…é€šå¸¸ä¸ä¼šè¢«é˜»å¡ï¼ˆé™¤éä½¿ç”¨äº†æŸäº› <code>blockingxxx</code>
å‡½æ•°ï¼‰ã€‚å› æ­¤å¯¹äºç±»ä¼¼çš„æƒ…æ™¯ï¼Œä¼¼ä¹ <code>launchin</code>
åº”è¯¥æ˜¯æˆ‘ä»¬çš„é¦–é€‰ã€‚</p>
<h4 id="flowof">flowOf</h4>
<p>ä¸º <code>flowOf</code> å‡è®¾çš„æƒ…æ™¯ä¸ <code>Observable.just</code>
ç±»ä¼¼ï¼šæˆ‘ä»¬ç°åœ¨éœ€è¦è¿›è¡Œä¸€äº›è®¡ç®—ï¼ˆæŒ‚èµ·çš„ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨å¤–éƒ¨èŒƒå›´å†…å®Œæˆï¼Œä¸å—
<code>flowOn</code> çš„å½±å“ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*jTX93fFjuwjxR33NLaSkmA.png"></p>
<p>å¦‚æœåœ¨å¸¦æœ‰ <code>Dispatchers.Main</code> çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œé‚£ä¹ˆ
<code>calculate</code> å°†åœ¨ä¸»çº¿ç¨‹ä¸Šå®Œæˆè€Œä¸æ˜¯è¾“å…¥è¾“å‡ºä¸Šè¿è¡Œã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>flow</code>
æ„å»ºå™¨å¹¶åœ¨å…¶ä¸­æ˜ç¡®å®šä¹‰å†…å®¹ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*JSkHKLjh9X-YDL1Olkl5hQ.png"></p>
<p>ç„¶åå°†åœ¨è¾“å…¥è¾“å‡ºçº¿ç¨‹ä¸Šè¿›è¡Œè®¡ç®—ã€‚</p>
<h4 id="flatmapmerge-å¹¶å‘å’Œå¹¶è¡Œ">FlatMapMerge å¹¶å‘å’Œå¹¶è¡Œ</h4>
<p>ä¸ºäº†äº†è§£ Kotlin Flow å¦‚ä½•ä¸ <code>flatMapMerge</code>ï¼ˆå¯¹ RxJava ä¸­
<code>flatMap</code> çš„æ¨¡æ‹Ÿï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€äº›æµ‹è¯•ç¤ºä¾‹ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*_G4_NwfgY1wmO7aVoamsrw.png"></p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰åœ¨ <code>d1</code>
è°ƒåº¦å™¨ä¸Šæ”¶é›†çš„æµã€‚è¿™ä¸ªæµæœ‰ä¸¤ä¸ªé¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½å¹³é¢æ˜ å°„åˆ°å…¶ä»–ä¸¤ä¸ªé¡¹ç›®ä¸Šã€‚è€Œä¸”æˆ‘ä»¬åœ¨
<code>d2</code> è°ƒåº¦å™¨ä¸Šæœ‰ä¸€ä¸ª <code>flowOn</code> å®šä¹‰ã€‚</p>
<p>åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº† <code>onEach</code>
çš„è°ƒç”¨ï¼Œç”¨äºè¾“å‡ºæ‰§è¡Œçš„çº¿ç¨‹çš„ä¿¡æ¯ã€‚</p>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè¾“å‡ºä¸ºï¼š</p>
<pre><code>inner: pool-2-thread-2 @coroutine#4
inner: pool-2-thread-3 @coroutine#5
inner: pool-2-thread-3 @coroutine#5
inner: pool-2-thread-2 @coroutine#4
collect: pool-1-thread-2 @coroutine#2
collect: pool-1-thread-2 @coroutine#2
collect: pool-1-thread-2 @coroutine#2
collect: pool-1-thread-2 @coroutine#2</code></pre>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å‘ç°ä¸ RxJava ä¸åŒçš„æ˜¯ï¼Œå³ä½¿æˆ‘ä»¬å°† <code>flowOn</code>
æ”¾åœ¨å…¶ä¸­çš„ <code>flatMapMerge</code> ä¹‹å¤–ï¼ˆä¹‹åï¼‰ï¼Œ<code>flowOn</code>
ä¹Ÿä¼šé€šè¿‡åœ¨å¤šä¸ªçº¿ç¨‹ä¸Šå¹¶è¡Œè¿è¡Œæ¥å½±å“å…¶ä¸­çš„ä»£ç æ‰§è¡Œã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°† <code>flowOn</code> æ”¾åœ¨ <code>flatMapMerge</code>
ä¸­ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*sv6HwmwwsOufpc-00wZpCQ.png"></p>
<p>æˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™äº›ç»“æœï¼š</p>
<pre><code>inner: pool-2-thread-2 @coroutine#6
inner: pool-2-thread-1 @coroutine#7
inner: pool-2-thread-2 @coroutine#6
inner: pool-2-thread-1 @coroutine#7
collect: pool-1-thread-3 @coroutine#2
collect: pool-1-thread-3 @coroutine#2
collect: pool-1-thread-3 @coroutine#2
collect: pool-1-thread-3 @coroutine#2</code></pre>
<p>åŒæ ·ï¼Œæ¯ä¸ªå†…éƒ¨æµéƒ½åœ¨å…¶è‡ªå·±çš„çº¿ç¨‹çš„ç¬¬äºŒä¸ªæ± åœ¨ä¸Šè¿è¡Œã€‚å› æ­¤ï¼Œåœ¨å“ªé‡Œå®šä¹‰
<code>flowOn</code> ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<p>ä½†æ˜¯å…¶å®æœ‰ä¸€ä¸ªåŒºåˆ« â€”â€” è®©æˆ‘ä»¬é€šè¿‡åœ¨ç¬¬ä¸€ä¸ª <code>flowOf</code>
è°ƒç”¨ä¸‹é¢æ·»åŠ  <code>onEach</code> æ¥çœ‹çœ‹å®ƒæ˜¯ä»€ä¹ˆï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*isZ3b5z8Jg7f-V9tOqdFlw.png"></p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>outer: pool-2-thread-1 @coroutine#3
outer: pool-2-thread-1 @coroutine#3
inner: pool-2-thread-2 @coroutine#4
inner: pool-2-thread-3 @coroutine#5
inner: pool-2-thread-3 @coroutine#5
inner: pool-2-thread-2 @coroutine#4
collect: pool-1-thread-2 @coroutine#2
collect: pool-1-thread-2 @coroutine#2
collect: pool-1-thread-2 @coroutine#2
collect: pool-1-thread-2 @coroutine#2</code></pre>
<p>è¿™æ„å‘³ç€æ‰€æœ‰åœ¨ <code>flowOn</code> ä»¥å‰çš„ä»£ç éƒ½ä¼šåœ¨ç¬¬äºŒä¸ª pool
ä¸­è¿è¡Œï¼Œå¤–é¢çš„ä»£ç ä¼šåœ¨ç¬¬ä¸€çº¿ç¨‹ï¼Œè€Œæ¯ä¸€ä¸ªé‡Œé¢çš„ flow
éƒ½ä¼šæœ‰å±äºå®ƒè‡ªå·±çš„çº¿ç¨‹ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*dfWRpulMkYT_8aNiXJVCPA.png"></p>
<p>çº¢è‰²éƒ¨åˆ†è¿è¡Œåœ¨ <code>d2</code> è€Œè“è‰²éƒ¨åˆ†è¿è¡Œåœ¨ <code>d1</code>ã€‚</p>
<p>ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœæˆ‘ä»¬æŠŠ <code>flowOn</code> æ”¾åœ¨
<code>flatMapMerge</code> ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*SM6l5_038WGzm9Z4Zd97nA.png"></p>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code>outer: pool-1-thread-2 @coroutine#3
outer: pool-1-thread-2 @coroutine#3
inner: pool-2-thread-1 @coroutine#6
inner: pool-2-thread-2 @coroutine#7
inner: pool-2-thread-1 @coroutine#6
inner: pool-2-thread-2 @coroutine#7
collect: pool-1-thread-3 @coroutine#2
collect: pool-1-thread-3 @coroutine#2
collect: pool-1-thread-3 @coroutine#2
collect: pool-1-thread-3 @coroutine#2</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¤–é¢çš„è¿è¡Œåœ¨äº† <code>d1</code>ï¼Œä¹Ÿå› è€Œæ²¡æœ‰è¢«
<code>flowOn</code> å½±å“ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*5D5AHoF0nPJyD7lcMvp0cA.png"></p>
<p>è¿™å°±æ˜¯å®ƒä»¬é—´çš„å·®å¼‚ã€‚</p>
<h2 id="æ¯”è¾ƒ">æ¯”è¾ƒ</h2>
<p>ç°åœ¨è®©æˆ‘ä»¬æ¥åšä¸€äº›æ¯”è¾ƒå’Œæ€»ç»“ï¼Œä¹Ÿçœ‹çœ‹å‡ ä¸ªä¾‹å­ã€‚</p>
<p>ä»æ¯”è¾ƒéƒ¨åˆ†æ¥çœ‹ï¼ŒRxJava å’Œ Kotlin Flow éƒ½å±•ç°å‡º cold
streamsã€‚ä¸¤è€…éƒ½æœ‰ä¸€èˆ¬çš„æ“ä½œç¬¦å’Œæ–¹æ³•æ¥æ”¹å˜é“¾ä¸­çš„çº¿ç¨‹ï¼ˆè°ƒåº¦å™¨æˆ–åˆ†é…å™¨ï¼‰ã€‚</p>
<h4 id="çº¿ç¨‹çš„æ§åˆ¶">çº¿ç¨‹çš„æ§åˆ¶</h4>
<p>åœ¨RxJavaä¸­ï¼Œç”¨äºçº¿ç¨‹çš„<strong>è°ƒåº¦å™¨</strong>è¢«ä½¿ç”¨ï¼ˆæœ€å¸¸è§çš„æœ‰
<code>io()</code>ã€<code>computation()</code>ã€<code>mainThread()</code>ï¼‰ã€‚</p>
<p>åœ¨Kotlin Flowä¸­ï¼Œç”¨äºçº¿ç¨‹çš„<strong>è°ƒåº¦å™¨</strong>æœ€å¸¸è§çš„æ˜¯
<code>IO</code>ã€<code>Default</code>ã€<code>Main</code>ï¼‰ã€‚</p>
<h4 id="çº¿ç¨‹æ“ä½œç¬¦">çº¿ç¨‹æ“ä½œç¬¦</h4>
<p>åœ¨RxJavaä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<strong>subscribeOn</strong>å£°æ˜å“ªä¸ªè°ƒåº¦å™¨é“¾åº”è¯¥è¢«<strong>è®¢é˜…ï¼ˆå¯åŠ¨ï¼‰</strong>ï¼Œä½¿ç”¨
<code>observeOn</code> å£°æ˜å®ƒåº”è¯¥åœ¨å“ªé‡Œè¿›è¡Œã€‚</p>
<p>åœ¨ Kotlin Flow ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ”¶é›†æµçš„ Scope
å®šä¹‰äº†åœ¨ä½¿ç”¨åœ¨å“ªä¸ªä¸Šä¸‹æ–‡ï¼ˆè°ƒåº¦å™¨ï¼‰ä¸Šæ”¶é›†å®Œè¿™ä¸ªé“¾ï¼Œä»¥åŠåœ¨
<code>flowOn</code> ä¹‹å‰å®ƒçš„æ‰§è¡Œçš„åœ°æ–¹ã€‚</p>
<p>è¿™å°±åƒæ˜¯ä¸ªå€’è¿‡æ¥çš„æ–¹æ³•ã€‚åœ¨ RxJava
ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢å£°æ˜å¯åŠ¨å’Œä¿®æ”¹é“¾ã€‚</p>
<p>è€Œåœ¨ Kotlin Flow ä¸­ï¼Œæˆ‘ä»¬å£°æ˜ç”¨äºåœ¨ä¸Šé¢ä¿®æ”¹é“¾ã€‚</p>
<h4 id="è¿ç§»ä¾‹å­">è¿ç§»ä¾‹å­</h4>
<p>è€ƒè™‘ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›å¤æ‚çš„ RxJava é“¾ï¼Œæˆ‘ä»¬å¸Œæœ›è¿ç§»åˆ° Kotlin
Flowï¼Œå¹¶ä¿æŒçº¿ç¨‹é€»è¾‘ä¸å˜ã€‚ä»ä¸Šæ–‡ä¸­æˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼ŒåŸºæœ¬ä¸Šéµå¾ªä¸Šä¸‹é¢ å€’çš„æ€ç»´æ–¹å¼å°±å¯ä»¥äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å®Œæˆä»£ç è¿ç§»åï¼Œè¿˜è¦è®°å¾—è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>åŒæ ·ï¼Œæˆ‘ä»¬åº”è¯¥å·²ç»è®°ä½ï¼š RxJava
ä¸­çš„éé˜»å¡çº¿ç¨‹å’Œåœ¨åç¨‹ä¹‹é—´é‡ç”¨çº¿ç¨‹å¹¶æŒ‚èµ·æ˜¯ä¸åŒçš„æ–¹æ³•ï¼Œè€Œä¸”ä¸¤è€…æ˜¯æ— æ³•å»ºç«‹ç²¾ç¡®çš„ä¸€å¯¹ä¸€å…³ç³»çš„ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥æ–½åŠ ä¸€äº›çº¦æŸï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›å°†å¹¶è¡Œæ€§ä¿æŒåœ¨æˆ‘ä»¬æ‹¥æœ‰å¹¶è¡Œæ€§çš„ä½ç½®ï¼Œå¹¶åœ¨ç›¸åŒçš„çº¿ç¨‹æ± ä¸Šè¿è¡Œç›¸åŒçš„ä»£ç å—ã€‚</p>
<p>ä¸ºäº†ä½¿æˆ‘ä»¬çš„æµ‹è¯•ç¤ºä¾‹å°½å¯èƒ½æ­£ç¡®ï¼Œæˆ‘ä»¬å°†åœ¨è°ƒåº¦å™¨ä¹‹é—´ä½¿ç”¨ Java
æ‰§è¡Œç¨‹åºã€‚</p>
<p>RxJava çš„éƒ¨åˆ†ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*24TAclWSQTvfOlYIw9I65w.png"></p>
<p>Kotlin Flow çš„é‚£ä¸€éƒ¨åˆ†ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*6WmwuDO_EMLlyHLDycCu8A.png"></p>
<p>æˆ‘ä»¬å°†æ‹¥æœ‰ 4 ä¸ªåŒ…å« 3 ä¸ªçº¿ç¨‹çš„æ± ï¼Œè€Œä¸»è¦æ‰§è¡Œè€…åªæœ‰ 1 ä¸ªçº¿ç¨‹ã€‚</p>
<p>æˆ‘ä»¬çš„ RxJava çš„ç¤ºä¾‹å°†å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*nYL6iK4SOlMEh9YMOsSbKQ.png"></p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸‰ä¸ªé¡¹ç›®æµï¼Œå®ƒä»¬ä» s1 å¼€å§‹ï¼Œç„¶åå°†æ‰§è¡Œåˆ‡æ¢åˆ° s2ã€‚åœ¨
<code>flatMap</code>
å†…éƒ¨ï¼Œæˆ‘ä»¬è®¾ä¸‹äº†å¯è§‚å¯Ÿçš„è®¢é˜…ï¼ˆå…è®¸å¹¶è¡Œï¼‰ä»¥åŠä¸€äº›çº¿ç¨‹åˆ‡æ¢ã€‚ç„¶åï¼Œåœ¨å¹³é¢æ˜ å°„ä¹‹åï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸€äº›ä»£ç çš„æ‰§è¡Œå¹¶åœ¨ä¸»çº¿ç¨‹ä¸­æ‰“å°ç»“æœã€‚</p>
<p>è¿è¡Œç¨‹åºåï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p>
<pre><code>1: pool-1-thread-1
1: pool-1-thread-1
1: pool-1-thread-1
2: pool-3-thread-1
2: pool-3-thread-1
2: pool-3-thread-1
inner 1: pool-4-thread-1
inner 1: pool-4-thread-2
inner 1: pool-4-thread-1
inner 1: pool-4-thread-1
inner 1: pool-4-thread-2
inner 1: pool-4-thread-2
inner 1: pool-4-thread-3
inner 2: pool-5-thread-1
inner 2: pool-5-thread-2
3: pool-5-thread-1
inner 2: pool-5-thread-2
inner 1: pool-4-thread-3
inner 2: pool-5-thread-2
inner 2: pool-5-thread-3
3: pool-5-thread-1
3: pool-5-thread-1
3: pool-5-thread-1
end: pool-6-thread-1
end: pool-6-thread-1
inner 1: pool-4-thread-3
end: pool-6-thread-1
3: pool-5-thread-1
inner 2: pool-5-thread-1
3: pool-5-thread-1
inner 2: pool-5-thread-3
inner 2: pool-5-thread-1
end: pool-6-thread-1
3: pool-5-thread-3
3: pool-5-thread-3
end: pool-6-thread-1
inner 2: pool-5-thread-3
3: pool-5-thread-3
end: pool-6-thread-1
end: pool-6-thread-1
end: pool-6-thread-1
end: pool-6-thread-1</code></pre>
<p>å®ƒå¾ˆé•¿ï¼Œä½†æ˜¯åº”è¯¥ç¬¦åˆæˆ‘ä»¬ä¹‹å‰å†™çš„å‡è®¾ã€‚</p>
<p>è®©æˆ‘ä»¬ç›´è§‚åŒ–æ˜¾ç¤ºä¸€ä¸‹æ•°æ®ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*VNsQnjyftFkMvtcPD8x_rQ.png"></p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç²¾ç¡®åœ°çœ‹åˆ°ä¸Šé¢æ‰€è¿°çš„å†…å®¹ã€‚å…¶ä¸­éœ€è¦é‡ç‚¹å…³æ³¨çš„å†…å®¹æ˜¯ï¼Œ<code>3</code>
ä¸ <code>inner 2</code>
åœ¨åŒä¸€è°ƒåº¦å™¨ä¸Šè¿è¡Œã€‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªèµ·ç‚¹ï¼ˆåˆå§‹èµ·ç‚¹å’Œå†…éƒ¨èµ·ç‚¹ï¼‰ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†
<code>subscribeOn</code>
å…è®¸åœ¨å†…éƒ¨å¹¶è¡Œã€‚ç„¶åç§»åŠ¨åˆ°é“¾çš„ä¸‹æ–¹ï¼Œå¹¶åœ¨å¿…è¦æ—¶æ·»åŠ äº†
<code>observeOn</code> çš„å®šä¹‰ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ° Kotlin Flow çš„ç‰ˆæœ¬ï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*qIELqmv38MzyvsUml8QUYw.png"></p>
<p>ä»ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬å°±å°†ä¸»çº¿ç¨‹å›ºå®šä¸ºç»“æŸçš„çº¿ç¨‹ã€‚ç„¶åæˆ‘ä»¬ä»æœ€ä¸‹é¢å¼€å§‹çœ‹èµ·ï¼Œæˆ‘ä»¬åœ¨éœ€è¦çš„åœ°æ–¹æ·»åŠ 
<code>flowOn</code>ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ·»åŠ äº† <code>d4</code> å¹¶æ³¨æ„åˆ°
<code>inner 2</code> ä¹Ÿåº”åœ¨å…¶ä¸Šè¿è¡Œã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°
<code>d3</code>ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°é“¾çš„æœ€é¡¶ç«¯ã€‚ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>1: pool-1-thread-1 @coroutine#6
1: pool-1-thread-1 @coroutine#6
1: pool-1-thread-1 @coroutine#6
2: pool-2-thread-2 @coroutine#5
2: pool-2-thread-2 @coroutine#5
2: pool-2-thread-2 @coroutine#5
inner 1: pool-3-thread-1 @coroutine#10
inner 1: pool-3-thread-2 @coroutine#11
inner 1: pool-3-thread-3 @coroutine#12
inner 1: pool-3-thread-2 @coroutine#11
inner 1: pool-3-thread-3 @coroutine#12
inner 2: pool-4-thread-3 @coroutine#9
inner 1: pool-3-thread-1 @coroutine#10
inner 1: pool-3-thread-3 @coroutine#12
inner 1: pool-3-thread-2 @coroutine#11
inner 2: pool-4-thread-1 @coroutine#7
inner 2: pool-4-thread-2 @coroutine#8
inner 2: pool-4-thread-1 @coroutine#7
inner 2: pool-4-thread-3 @coroutine#9
inner 1: pool-3-thread-1 @coroutine#10
3: pool-4-thread-1 @coroutine#3
inner 2: pool-4-thread-3 @coroutine#9
inner 2: pool-4-thread-2 @coroutine#8
end: pool-5-thread-1 @coroutine#2
3: pool-4-thread-1 @coroutine#3
inner 2: pool-4-thread-2 @coroutine#8
3: pool-4-thread-1 @coroutine#3
end: pool-5-thread-1 @coroutine#2
3: pool-4-thread-1 @coroutine#3
end: pool-5-thread-1 @coroutine#2
end: pool-5-thread-1 @coroutine#2
3: pool-4-thread-1 @coroutine#3
3: pool-4-thread-1 @coroutine#3
end: pool-5-thread-1 @coroutine#2
end: pool-5-thread-1 @coroutine#2
3: pool-4-thread-1 @coroutine#3
3: pool-4-thread-1 @coroutine#3
end: pool-5-thread-1 @coroutine#2
end: pool-5-thread-1 @coroutine#2
inner 2: pool-4-thread-1 @coroutine#7
3: pool-4-thread-1 @coroutine#3
end: pool-5-thread-1 @coroutine#2</code></pre>
<p>é™¤äº†æ—¥å¿—çš„å¤–è§‚ä¸åŒï¼ˆå› ä¸º RxJava
ä¸åç¨‹ä¸åŒï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥çœ‹åˆ°æ‰€æœ‰é€»è¾‘ä»ç„¶é€‚ç”¨ï¼Œå¹¶ä¸”æˆ‘ä»¬æ²¡æœ‰ç ´åå¹¶è¡Œæ‰§è¡Œã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬ä»ç„¶å¯ä»¥çœ‹åˆ°ä¸€äº›å·®å¼‚ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨RxJavaç¤ºä¾‹ä¸­è¿è¡Œâ€œ
3â€çš„ä»£ç åœ¨ä»¥ä¸‹ä½ç½®è¿è¡Œï¼š</p>
<pre><code>3: pool-5-thread-1
...
3: pool-5-thread-3</code></pre>
<p>åœ¨åç¨‹ç¤ºä¾‹ä¸­ï¼Œå®ƒæ€»æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œï¼š</p>
<pre><code>3: pool-4-thread-1 @coroutine#3</code></pre>
<p>è¿™å¯èƒ½æ˜¯ç”±äºå¹¶å‘è€Œå¼•èµ·çš„å·§åˆï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºåç¨‹ç¨‹åºæ›´å¥½åœ°åˆ©ç”¨äº†çº¿ç¨‹çš„ä½¿ç”¨ï¼ˆæˆ–è€…å¯èƒ½ä¸æ˜¯ï¼Œå®é™…ä¸Šæˆ‘ä¸çŸ¥é“ï¼Œæ‰€ä»¥å¦‚æœæœ‰äººæœ‰å…¶ä»–æƒ³æ³•ï¼Œå¯ä»¥æ¯«ä¸çŠ¹è±«åœ°å‘å¸ƒå“åº”ï¼‰ã€‚å°½ç®¡æˆ‘ä»¬ä¸å¤ªåœ¨ä¹ï¼Œå› ä¸ºæ— è®ºå¦‚ä½•çº¿ç¨‹æ± çš„ä½¿ç”¨éƒ½æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å¯è§†åŒ–çº¿ç¨‹ï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<p><img src="https://cdn-images-1.medium.com/max/2000/1*z6XDLAkVgMLmyeYsvSTbbA.png"></p>
<h2 id="å°ç»“">å°ç»“</h2>
<p>Kotlin Flow çœŸçš„ä¸é”™ï¼Œå¯ä»¥è·Ÿ RxJava Observable
ç›¸åª²ç¾ã€‚å®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•å’Œæ”¯æŒçš„è¿ç®—ç¬¦éƒ½ç›¸ä¼¼ï¼Œç›¸ä¼¼çš„è¿ç®—ç¬¦ï¼Œå¹¶ä¸”éƒ½åœ¨å…¶é“¾å†…å¤„ç†çº¿ç¨‹ã€‚ä»–ä»¬åœ¨ä½¿ç”¨
<code>Observable.just</code> æˆ– <code>flowOf</code>
æ—¶ä¹Ÿæœ‰ç±»ä¼¼çš„æŠ€å·§ã€‚ä½†æ˜¯å°±å¹¶å‘æ€§å’Œå¹¶è¡Œæ€§è€Œè¨€ï¼ŒKotlin Flow
ä¼¼ä¹æ›´ç®€æ´ã€‚åŒæ ·ï¼ŒKotlin Flow ä¹Ÿæ²¡æœ‰è¯¸å¦‚å¸¦æœ‰ <code>subscribeOn</code> çš„
RxJava
è¿™æ ·çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨æµç¨‹ä¸­ï¼Œæˆ‘ä»¬ç”¨ä½œç”¨åŸŸå£°æ˜äº†é“¾çš„æœ«å°¾ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œä¸å¯èƒ½å°†å®ƒä»¬æ”¾å¤šä¸ªã€‚</p>
<p>åœ¨å¤„ç†çº¿ç¨‹çš„æ–¹å¼ä¸Šï¼ŒKotlin Flow å’Œ RxJava æ˜¯ç›¸åçš„ã€‚åœ¨ RxJava
ä¸­ï¼Œæˆ‘ä»¬è®¤ä¸ºæ˜¯ä»ä¸Šåˆ°ä¸‹ï¼Œè€Œåœ¨ Kotlin Flow
ä¸­åˆ™æ˜¯ä»ä¸‹åˆ°ä¸Šã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œåœ¨ä¸ç ´åå¤§éƒ¨åˆ†åŠŸèƒ½çš„å‰æä¸‹ï¼Œå°†ä»£ç è¿›è¡Œåå‘è¿ç§»ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚</p>
<p>å¸Œæœ›æ‚¨å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½†æ„¿å®ƒå¯¹æ‚¨æœ‰æ‰€å¸®åŠ©</p>
<p>ç¥ä½ ç¼–ç¨‹å¿«ä¹ï¼</p>



            </div>
        </article>
        <div class="sidebar">
            <div class="about-box">
    <div class="avatar">
        <img src="/assets/media/bitmap/avatar.jpeg" alt="avatar">
    </div>
    <h1>éœœç¾½ Hoarfroster</h1>
    <h2>@PassionPenguin</h2>
    <p class="moment"><span class="status">ğŸ¤”</span><span>åŠªåŠ›ï¼</span></p>
    <ul>
        <li><i class="fa-solid fa-location-dot"></i> å¹¿ä¸œ Â· å¹¿å· | <span class="light">Guangzhou, China</span>
        </li>
        <li><i class="fa-solid fa-envelope"></i> <a href="mailto:hoarfroster@outlook.com">hoarfroster@outlook.com</a>
        </li>
        <li><i class="fa-solid fa-house"></i> <a href="https://story.hoarfroster.space/">https://story.hoarfroster.space/</a>
        </li>
    </ul>
</div>
<div class="organization">
    <h4>ç»„ç»‡ Organizations</h4>
    <ul>
        <li>
            <img src="https://avatars.githubusercontent.com/u/81648011?s=60&amp;v=4"
                alt="Hexa-Penguin"><span>Hexa-Penguin</span>
        </li>
        <li>
            <img src="https://avatars.githubusercontent.com/u/10482599?s=60&amp;v=4" alt="xitu"><span>ç¨€åœŸ xitu</span>
        </li>
    </ul>
</div>
<div class="category">
    <span class="title">æ–‡ç« åˆ†ç±»</span>
    <ul>
        <!-- <li><a href="/archive.html">æ‰€æœ‰åˆ†ç±»</a></li> -->
    </ul>
</div>
<div class="archive">
    <span class="title">æ–‡ç« å­˜æ¡£</span>
    <ul>
        <!-- <li><a href="/archive.html">æ‰€æœ‰æ–‡ç« </a></li> -->
    </ul>
</div>
        </div>
    </div>
    <div class="footer">
    <div class="content">
        <div class="about">
            <p>éœœç¾½ Hoarfroster</p>
            <p>&copy; Copyright 2021 Hoarfroster and contributors.</p>
        </div>
        <div class="nav">
            <div class="links">
                <span class="title">å…³äºæ–‡ç« </span>
                <ul>
                    <li><a href="/archive.html">æ–‡ç« å­˜æ¡£</a></li>
                </ul>
            </div>
            <div class="category">
                <span class="title">å…³äºéœœç¾½</span>
                <ul>
                    <li><a href="/about.html">æœ‰å…³éœœç¾½</a></li>
                </ul>
            </div>
        </div>
    </div>
    <ul class="social-accounts">
        <li>
            <a href="https://www.zhihu.com/people/shuang-yu-29-75">
                <i class="fa-brands fa-zhihu" style="font-size: 24px; color:#06f; line-height: 24px;"></i>
            </a>
        </li>
        <li>
            <a href="https://github.com/PassionPenguin">
                <img src="/assets/media/vectors/github.svg" alt="github-logo"/>
            </a>
        </li>
        <li>
            <a href="https://dribbble.com/Hoarfroster">
                <img src="/assets/media/vectors/dribbble.svg" alt="dribbble-logo"/>
            </a>
        </li>
        <li>
            <a href="https://zh.wikipedia.org/wiki/User:HoarfrostFeather">
                <i class="fa-brands fa-wikipedia-w" style="font-size: 22px; color: #888; line-height: 24px;"></i>
            </a>
        </li>
        <li>
            <a href="https://space.bilibili.com/201469972">
                <i class="fa-brands fa-bilibili" style="font-size: 22px; color: #00a1d6; line-height: 24px;"></i>
            </a>
        </li>
    </ul>
</div>
</body>

</html>